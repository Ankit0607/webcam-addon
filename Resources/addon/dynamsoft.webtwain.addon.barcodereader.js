// 20200605 1340
var Dynamsoft=self.Dynamsoft||{WebTwainEnv:{}};Dynamsoft.aryAddonReadyFun=Dynamsoft.aryAddonReadyFun||[];Dynamsoft.AddonReady=Dynamsoft.AddonReady||function(a){Dynamsoft.aryAddonReadyFun.push(a)};(function(){Dynamsoft.BarcodeReaderAddon=Dynamsoft.BarcodeReaderAddon||{};var a=Dynamsoft.BarcodeReaderAddon;a.Version="7.4.0.0428";a.VersionForActiveX="7.4.0.0428";a._defaultRuntimeSettingsStr="";a._defaultTemplateStr="";a._wasmInstance=false;a._activeXInstance=false;a.BarcodeReaderException=(function(){var b=function(){var d;var c=arguments[0],f=arguments[1],e=Dynamsoft.EnumErrorCode.DBR_UNKNOWN;if(typeof c=="number"){e=c;d=new Error(f)}else{d=new Error(c)}d.code=e;return d};return b})();a.RemoveNonPrintableChar=function(b){if(Dynamsoft.Lib.isString(b)){return b.replace(/[^\x20-\x7E]|(\\")/g,"")}else{return b}};a.errors={webcamNotInstalled:"The Webcam add-on not installed.",nonServiceNotSupportWebcamDecode:"The BarcodeReader add-on does not support reading barcodes from video streams.",decodeResultEmpty:"decode result is empty."};a._activeXMaxIEVersion=9;a.logLevel=3;a.unload=function(){if(a._wasmInstance){a._wasmInstance.destroy();a._wasmInstance=false}return Promise.resolve()};Dynamsoft.EnumAccompanyingTextRecognitionMode={ATRM_GENERAL:1,ATRM_SKIP:0};Dynamsoft.EnumBarcodeColourMode={BICM_DARK_ON_LIGHT:1,BICM_LIGHT_ON_DARK:2,BICM_DARK_ON_DARK:4,BICM_LIGHT_ON_LIGHT:8,BICM_DARK_LIGHT_MIXED:16,BICM_DARK_ON_LIGHT_DARK_SURROUNDING:32,BICM_SKIP:0};Dynamsoft.EnumBarcodeComplementMode={BCM_AUTO:1,BCM_GENERAL:2,BCM_SKIP:0};Dynamsoft.EnumBarcodeFormat={BF_ALL:-32505857,BF_ONED:2047,BF_GS1_DATABAR:260096,BF_CODE_39:1,BF_CODE_128:2,BF_CODE_93:4,BF_CODABAR:8,BF_ITF:16,BF_EAN_13:32,BF_EAN_8:64,BF_UPC_A:128,BF_UPC_E:256,BF_INDUSTRIAL_25:512,BF_CODE_39_EXTENDED:1024,BF_GS1_DATABAR_OMNIDIRECTIONAL:2048,BF_GS1_DATABAR_TRUNCATED:4096,BF_GS1_DATABAR_STACKED:8192,BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:16384,BF_GS1_DATABAR_EXPANDED:32768,BF_GS1_DATABAR_EXPANDED_STACKED:65536,BF_GS1_DATABAR_LIMITED:131072,BF_PATCHCODE:262144,BF_PDF417:33554432,BF_QR_CODE:67108864,BF_DATAMATRIX:134217728,BF_AZTEC:268435456,BF_MAXICODE:536870912,BF_MICRO_QR:1073741824,BF_MICRO_PDF417:524288,BF_GS1_COMPOSITE:-2147483648,BF_NULL:0};Dynamsoft.EnumBarcodeFormat_2={BF2_NULL:0,BF2_POSTALCODE:32505856,BF2_NONSTANDARD_BARCODE:1,BF2_USPSINTELLIGENTMAIL:1048576,BF2_POSTNET:2097152,BF2_PLANET:4194304,BF2_AUSTRALIANPOST:8388608,BF2_RM4SCC:16777216,BF2_DOTCODE:2};Dynamsoft.EnumBinarizationMode={BM_AUTO:1,BM_LOCAL_BLOCK:2,BM_SKIP:0};Dynamsoft.EnumClarityCalculationMethod={ECCM_CONTRAST:1};Dynamsoft.EnumClarityFilterMode={CFM_GENERAL:1};Dynamsoft.EnumColourClusteringMode={CCM_AUTO:1,CCM_GENERAL_HSV:2,CCM_SKIP:0};Dynamsoft.EnumColourConversionMode={CICM_GENERAL:1,CICM_SKIP:0};Dynamsoft.EnumConflictMode={CM_IGNORE:1,CM_OVERWRITE:2};Dynamsoft.EnumDeformationResistingMode={DRM_AUTO:1,DRM_GENERAL:2,DRM_SKIP:0};Dynamsoft.EnumDPMCodeReadingMode={DPMCRM_AUTO:1,DPMCRM_GENERAL:2,DPMCRM_SKIP:0};Dynamsoft.EnumErrorCode={DBR_SYSTEM_EXCEPTION:1,DBR_SUCCESS:0,DBR_UNKNOWN:-10000,DBR_NO_MEMORY:-10001,DBR_NULL_REFERENCE:-10002,DBR_LICENSE_INVALID:-10003,DBR_LICENSE_EXPIRED:-10004,DBR_FILE_NOT_FOUND:-10005,DBR_FILETYPE_NOT_SUPPORTED:-10006,DBR_BPP_NOT_SUPPORTED:-10007,DBR_INDEX_INVALID:-10008,DBR_BARCODE_FORMAT_INVALID:-10009,DBR_CUSTOM_REGION_INVALID:-10010,DBR_MAX_BARCODE_NUMBER_INVALID:-10011,DBR_IMAGE_READ_FAILED:-10012,DBR_TIFF_READ_FAILED:-10013,DBR_QR_LICENSE_INVALID:-10016,DBR_1D_LICENSE_INVALID:-10017,DBR_DIB_BUFFER_INVALID:-10018,DBR_PDF417_LICENSE_INVALID:-10019,DBR_DATAMATRIX_LICENSE_INVALID:-10020,DBR_PDF_READ_FAILED:-10021,DBR_PDF_DLL_MISSING:-10022,DBR_PAGE_NUMBER_INVALID:-10023,DBR_CUSTOM_SIZE_INVALID:-10024,DBR_CUSTOM_MODULESIZE_INVALID:-10025,DBR_RECOGNITION_TIMEOUT:-10026,DBR_JSON_PARSE_FAILED:-10030,DBR_JSON_TYPE_INVALID:-10031,DBR_JSON_KEY_INVALID:-10032,DBR_JSON_VALUE_INVALID:-10033,DBR_JSON_NAME_KEY_MISSING:-10034,DBR_JSON_NAME_VALUE_DUPLICATED:-10035,DBR_TEMPLATE_NAME_INVALID:-10036,DBR_JSON_NAME_REFERENCE_INVALID:-10037,DBR_PARAMETER_VALUE_INVALID:-10038,DBR_DOMAIN_NOT_MATCHED:-10039,DBR_RESERVEDINFO_NOT_MATCHED:-10040,DBR_AZTEC_LICENSE_INVALID:-10041,DBR_LICENSE_DLL_MISSING:-10042,DBR_LICENSEKEY_NOT_MATCHED:-10043,DBR_REQUESTED_FAILED:-10044,DBR_LICENSE_INIT_FAILED:-10045,DBR_PATCHCODE_LICENSE_INVALID:-10046,DBR_POSTALCODE_LICENSE_INVALID:-10047,DBR_DPM_LICENSE_INVALID:-10048,DBR_FRAME_DECODING_THREAD_EXISTS:-10049,DBR_STOP_DECODING_THREAD_FAILED:-10050,DBR_SET_MODE_ARGUMENT_ERROR:-10051,DBR_LICENSE_CONTENT_INVALID:-10052,DBR_LICENSE_KEY_INVALID:-10053,DBR_LICENSE_DEVICE_RUNS_OUT:-10054,DBR_GET_MODE_ARGUMENT_ERROR:-10055,DBR_IRT_LICENSE_INVALID:-10056,DBR_MAXICODE_LICENSE_INVALID:-10057,DBR_GS1_DATABAR_LICENSE_INVALID:-10058,DBR_GS1_COMPOSITE_LICENSE_INVALID:-10059,DBR_DOTCODE_LICENSE_INVALID:-10061};Dynamsoft.EnumGrayscaleTransformationMode={GTM_INVERTED:1,GTM_ORIGINAL:2,GTM_SKIP:0};Dynamsoft.EnumImagePixelFormat={IPF_Binary:0,IPF_BinaryInverted:1,IPF_GrayScaled:2,IPF_NV21:3,IPF_RGB_565:4,IPF_RGB_555:5,IPF_RGB_888:6,IPF_ARGB_8888:7,IPF_RGB_161616:8,IPF_ARGB_16161616:9,IPF_ABGR_8888:10,IPF_ABGR_16161616:11,IPF_BGR_888:12};Dynamsoft.EnumImagePreprocessingMode={IPM_AUTO:1,IPM_GENERAL:2,IPM_GRAY_EQUALIZE:4,IPM_GRAY_SMOOTH:8,IPM_SHARPEN_SMOOTH:16,IPM_MORPHOLOGY:32,IPM_SKIP:0};Dynamsoft.EnumIMResultDataType={IMRDT_IMAGE:1,IMRDT_CONTOUR:2,IMRDT_LINESEGMENT:4,IMRDT_LOCALIZATIONRESULT:8,IMRDT_REGIONOFINTEREST:16,IMRDT_QUADRILATERAL:32};Dynamsoft.EnumIntermediateResultSavingMode={IRSM_MEMORY:1,IRSM_FILESYSTEM:2,IRSM_BOTH:4};Dynamsoft.EnumIntermediateResultType={IRT_NO_RESULT:0,IRT_ORIGINAL_IMAGE:1,IRT_COLOUR_CLUSTERED_IMAGE:2,IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE:4,IRT_TRANSFORMED_GRAYSCALE_IMAGE:8,IRT_PREDETECTED_REGION:16,IRT_PREPROCESSED_IMAGE:32,IRT_BINARIZED_IMAGE:64,IRT_TEXT_ZONE:128,IRT_CONTOUR:256,IRT_LINE_SEGMENT:512,IRT_FORM:1024,IRT_SEGMENTATION_BLOCK:2048,IRT_TYPED_BARCODE_ZONE:4096,IRT_PREDETECTED_QUADRILATERAL:8192};Dynamsoft.EnumLocalizationMode={LM_SKIP:0,LM_AUTO:1,LM_CONNECTED_BLOCKS:2,LM_LINES:8,LM_STATISTICS:4,LM_SCAN_DIRECTLY:16,LM_STATISTICS_MARKS:32,LM_STATISTICS_POSTAL_CODE:64};Dynamsoft.EnumPDFReadingMode={PDFRM_RASTER:1,PDFRM_AUTO:2,PDFRM_VECTOR:4};Dynamsoft.EnumQRCodeErrorCorrectionLevel={QRECL_ERROR_CORRECTION_H:0,QRECL_ERROR_CORRECTION_L:1,QRECL_ERROR_CORRECTION_M:2,QRECL_ERROR_CORRECTION_Q:3};Dynamsoft.EnumRegionPredetectionMode={RPM_AUTO:1,RPM_GENERAL:2,RPM_GENERAL_RGB_CONTRAST:4,RPM_GENERAL_GRAY_CONTRAST:8,RPM_GENERAL_HSV_CONTRAST:16,RPM_SKIP:0};Dynamsoft.EnumResultCoordinateType={RCT_PIXEL:1,RCT_PERCENTAGE:2};Dynamsoft.EnumResultType={RT_STANDARD_TEXT:0,RT_RAW_TEXT:1,RT_CANDIDATE_TEXT:2,RT_PARTIAL_TEXT:3};Dynamsoft.EnumScaleUpMode={SUM_AUTO:1,SUM_LINEAR_INTERPOLATION:2,SUM_NEAREST_NEIGHBOUR_INTERPOLATION:4,SUM_SKIP:0};Dynamsoft.EnumTerminatePhase={TP_REGION_PREDETECTED:1,TP_IMAGE_PREPROCESSED:2,TP_IMAGE_BINARIZED:4,TP_BARCODE_LOCALIZED:8,TP_BARCODE_TYPE_DETERMINED:16,TP_BARCODE_RECOGNIZED:32};Dynamsoft.EnumTextAssistedCorrectionMode={TACM_AUTO:1,TACM_VERIFYING:2,TACM_VERIFYING_PATCHING:4,TACM_SKIP:0};Dynamsoft.EnumTextFilterMode={TFM_AUTO:1,TFM_GENERAL_CONTOUR:2,TFM_SKIP:0};Dynamsoft.EnumTextResultOrderMode={TROM_CONFIDENCE:1,TROM_POSITION:2,TROM_FORMAT:4,TROM_SKIP:0};Dynamsoft.EnumTextureDetectionMode={TDM_AUTO:1,TDM_GENERAL_WIDTH_CONCENTRATION:2,TDM_SKIP:0};a.Class=(function(){var b=Dynamsoft.Lib;var j=function(){this._runtimeSettings=null;this._initSettingsContent=null;this._tplContentArr=[];this.bWasm=false};j.prototype._decodeBlob=function(m,l){var k=this;return new Promise(function(n){if(!(m instanceof Blob)){throw TypeError("'_decodeBlob(blob, templateName)': Type of 'blob' should be 'Blob'.")}n()}).then(function(){return k._innerDecode(0,m,l)})};j.prototype._decodeArrayBuffer=function(m,l){var k=this;return new Promise(function(n){if(!(m instanceof ArrayBuffer)){throw TypeError("'_decodeBlob(arrayBuffer, templateName)': Type of 'arrayBuffer' should be 'ArrayBuffer'.")}n()}).then(function(){return k._innerDecode(0,m,l)})};j.prototype._decodeUint8Array=function(m,l){var k=this;return new Promise(function(n){if(!(m instanceof Uint8Array)&&!(self.Uint8ClampedArray&&m instanceof Uint8ClampedArray)){throw TypeError("'_decodeBlob(uint8Array, templateName)': Type of 'uint8Array' should be 'Uint8Array'.")}n()}).then(function(){return k._innerDecode(0,m,l)})};j.prototype._decodeImage=function(m,l){var k=this;return new Promise(function(n){if(!(m instanceof HTMLImageElement)){throw TypeError("'_decodeImage(image, templateName)': Type of 'image' should be 'HTMLImageElement'.")}if(m.crossOrigin&&"anonymous"!=m.crossOrigin){throw"cors"}l=l||"";n()}).then(function(){if(m.src.substring(0,11)=="data:image/"){return k._decodeBase64(m.src,l)}else{return k._decodeUrl(m.src,l)["catch"](function(o){if(a.logLevel>=3){if(console&&console.warn){console.warn("'_decodeImage(image, templateName)': Image src not available. Use '_decodeCanvas' instead.");console.warn(o)}}if(!self.HTMLCanvasElement){return Promise.reject(Error("'_decodeImage(image, templateName)': Browser not support HTMLCanvasElement."))}var p=document.createElement("canvas");p.width=m.naturalWidth;p.height=m.naturalHeight;var n=p.getContext("2d");n.drawImage(m,0,0);return k._decodeCanvas(p,l)})}})};j.prototype._decodeCanvas=function(m,l){var k=this;return new Promise(function(n){if(!(m instanceof HTMLCanvasElement)){throw TypeError("'_decodeCanvas(canvas, templateName)': Type of 'canvas' should be 'HTMLCanvasElement'.")}if(m.crossOrigin&&"anonymous"!=m.crossOrigin){throw"cors"}l=l||"";if(m.toBlob){m.toBlob(function(o){n(o)})}else{n(m.toDataURL())}}).then(function(n){if(m.toBlob){return k._decodeBlob(n,l)}else{return k._decodeBase64(n,l)}})};j.prototype._decodeVideo=function(n){var l=this;var m;var k=arguments;return new Promise(function(v){if(!(n instanceof HTMLVideoElement)){throw TypeError("'_decodeVideo(video [ [, sx, sy, sWidth, sHeight], dWidth, dHeight] [, templateName] )': Type of 'video' should be 'HTMLVideoElement'.")}if(n.crossOrigin&&"anonymous"!=n.crossOrigin){throw"cors"}var u,t,o,q,s,p;if(k.length<=2){u=t=0;o=s=n.videoWidth;q=p=n.videoHeight}else{if(k.length<=4){u=t=0;o=n.videoWidth;q=n.videoHeight;s=k[1];p=k[2]}else{u=k[1];t=k[2];o=k[3];q=k[4];s=k[5];p=k[6]}}m=(typeof k[k.length-1]=="string")?k[k.length-1]:"";var r=document.createElement("canvas");r.width=s;r.height=p;var w=r.getContext("2d");w.drawImage(n,u,t,o,q,0,0,s,p);v(r)}).then(function(o){return l._decodeCanvas(o,m)})};j.prototype._decodeBase64=j.prototype.decodeBase64String=function(m,l){var k=this;return new Promise(function(n){if(!(typeof m=="string"||typeof m=="object"&&m instanceof String)){throw TypeError("'decodeBase64(base64Str, templateName)': Type of 'base64Str' should be 'String'.")}if(m.substring(0,11)=="data:image/"){m=m.substring(m.indexOf(",")+1)}n()}).then(function(){return k._innerDecode(1,m,l)})};j.prototype._decodeUrl=function(m,l){var k=this;if(m&&m.indexOf&&(m.indexOf("dwt://")==0||m.indexOf("dcs://")==0)){return k._decodeDynamsoftServiceInnerUrl(m,l)}if(a._wasmInstance){return a._wasmInstance.decode(m)}return new Promise(function(p,o){if(!(typeof m=="string"||typeof m=="object"&&m instanceof String)){throw TypeError("'_decodeUrl(url, templateName)': Type of 'url' should be 'String'.")}l=l||"";if(a._activeXInstance){var n=new ActiveXObject("MSXML2.XMLHTTP");n.open("GET",m,true);if(n.overrideMimeType){n.overrideMimeType("text/plain; charset=x-user-defined")}else{n.setRequestHeader("Accept-Charset","x-user-defined")}n.onreadystatechange=function(){if(n.readyState==4){p(new VBArray(n.responseBody).toArray())}};n.send("")}else{var n=new XMLHttpRequest();n.open("GET",m,true);n.responseType="arraybuffer";n.send();n.onloadend=function(){p(this.response)};n.onerror=function(){o(n.error)}}}).then(function(n){if(a._activeXInstance){return k._activeXDecodeArray(n,l)}else{return k._decodeArrayBuffer(n,l)}})};j.prototype._decodeDynamsoftServiceInnerUrl=function(m,l){var k=this;return new Promise(function(n){if(!(typeof m=="string"||typeof m=="object"&&m instanceof String)){throw TypeError("'_decodeUrl(url, templateName)': Type of 'innerUrl' should be 'String'.")}if(!(m.indexOf("dwt://")==0||m.indexOf("dcs://")==0)){throw TypeError("'_decodeDynamsoftServiceInnerUrl(innerUrl, templateName)': 'innerUrl' should start with 'dwt://' or 'dcs://'.")}n()}).then(function(){return k._innerDecode(4000,m,l)})};j.prototype._activeXDecodeArray=function(m,l){var k=this;return new Promise(function(p,o){if(!(m instanceof Array)){throw TypeError("'_activeXDecodeArray(array, templateName)': Type of 'array' should be 'Array'.")}l=l||"";try{p(Dynamsoft.Lib.btoa(String.fromCharCode.apply(String,m)))}catch(n){o(n)}}).then(function(n){return k._decodeBase64(n,l)})};j.prototype._activeXDecodeHandle=function(m,l){var k=this;return new Promise(function(n){l=l||"";n()}).then(function(){return k._innerDecode(4001,m,l)})};j.prototype._decode=j.prototype.decode=function(l,k){if(a._activeXInstance){if((typeof l=="string"||l instanceof String)){return this._activeXDecodeHandle(l,k)}else{return Promise.reject(TypeError("'_decode(source, templateName)' in activeX: Type of 'source' should be 'String(partUrl)'."))}}else{if(a._wasmInstance){return a._wasmInstance.decode(url)}else{if(self.Blob&&l instanceof Blob){return this._decodeBlob(l,k)}else{if(self.ArrayBuffer&&l instanceof ArrayBuffer){return this._decodeArrayBuffer(l,k)}else{if((self.Uint8Array&&l instanceof Uint8Array)||(self.Uint8ClampedArray&&l instanceof Uint8ClampedArray)){return this._decodeUint8Array(l,k)}else{if(l instanceof Array){return this._activeXDecodeArray(l,k)}else{if(self.HTMLImageElement&&l instanceof HTMLImageElement){return this._decodeImage(l,k)}else{if(self.HTMLCanvasElement&&l instanceof HTMLCanvasElement){return this._decodeCanvas(l,k)}else{if(self.HTMLVideoElement&&l instanceof HTMLVideoElement){return this._decodeVideo(l,k)}else{if(!isNaN(l)){return this._activeXDecodeHandle(l,k)}else{if(typeof l=="string"||l instanceof String){if(l.substring(0,11)=="data:image/"){return this._decodeBase64(l,k)}else{return this._decodeUrl(l,k)}}else{return Promise.reject(TypeError("'_decode(source, templateName)' in H5: Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}}}}}}}}}}};var e=function(k){return typeof k==="number"&&k%1===0};var g=function(l){if(typeof l!="object"||l.length!=8){return false}for(var k=0;k<l.length;++k){if(!e(l[k])){return false}}return true};j.prototype._innerServiceCmd=function(l,k){return new Promise(function(o,n){var m={method:"ReadBarcode",parameter:[Dynamsoft.WebTwainEnv.ProductKey,4002,"",""],updateSettings:l,initSettingsContent:k};if(a._activeXInstance){o(a._activeXInstance.Process(b.stringify(m),location.protocol+"//"+location.host))}else{b.ajax({method:"POST",url:a._urlRoot+"ReadBarcode",data:b.stringify(m),onSuccess:function(p){o(p)},onError:function(q,p,r){n("Init template & runtimeSettings failed. Http info: "+r.status)},dataType:"text",async:true})}})};j.prototype._innerDecode=function(n,o,l,m){var k=this;if(k._runtimeSettings){if(k._runtimeSettings.expectedBarcodesCount==0){k._runtimeSettings.expectedBarcodesCount=512}}return new Promise(function(t,s){var r={method:"ReadBarcode",parameter:[Dynamsoft.WebTwainEnv.ProductKey,n,n!=0?o:null,l||""],updateSettings:k._runtimeSettings,conflictMode:1==k.conflictMode?"ignore":"overwrite",initSettingsContent:k._initSettingsContent,tplContent:(function(){if(l){for(var u=0;u<k._tplContentArr.length;++u){if(l==k._tplContentArr[u].ImageParameter.Name){return b.stringify(k._tplContentArr[u])}}}return null})()};if(b.product.bHTML5Edition){if(m){r.parameter.push(m)}}var q=function(w,D,C){try{var A=c(w);if(!A||!A.textResults){s(new a.BarcodeReaderException(A.exception,A.description))}if(b.product.bHTML5Edition&&C&&C.config.data){var y=b.parse(C.config.data),x;if(b.isArray(y.parameter)&&y.parameter.length>2){if(y.parameter[1]==4000){if(y.parameter.length>4&&y.parameter[4]){A.textResults.imageid=y.parameter[4]}else{var z,v;z=y.parameter[2];v=z.indexOf("&index=");if(v>=0){A.textResults.imageid=z.substring(v+7,z.indexOf("&t="))}}}}}for(x=0;x<A.textResults.length;x++){var u=A.textResults[x];u.BarcodeText=u.barcodeText;if(A.exception!=Dynamsoft.EnumErrorCode.DBR_SUCCESS){u.exception=A.exception}}if(A.exception!=Dynamsoft.EnumErrorCode.DBR_SUCCESS){A.textResults.exception=A.exception;A.textResults.description=A.description}t(A.textResults)}catch(B){s(B)}};if(a._activeXInstance){q(a._activeXInstance.Process(b.stringify(r),location.protocol+"//"+location.host))}else{var p=a._urlRoot+"ReadBarcode";b.ajax({method:"POST",url:0!=n?p:p+="/LoadZipFromBytes?cmd="+encodeURIComponent(b.stringify(r)),data:0!=n?b.stringify(r):o,onSuccess:function(w,v,u){q(w,v,u)},onError:function(v,u,w){s("ReadBarcode request fail. Info: "+w.status)},dataType:"text",async:true})}})};var c=a._handleRetJsonString=function(m){var l;if(typeof m=="string"||typeof m=="object"&&m instanceof String){try{l=b.parse(m)}catch(k){l=b.parse(a.RemoveNonPrintableChar(m))}}else{l=m}if(!l){throw a.BarcodeReaderException(Dynamsoft.EnumErrorCode.DBR_UNKNOWN,a.errors.decodeResultEmpty)}if("textResults" in l&&b.isArray(l.textResults)){}else{if(l.exception!=Dynamsoft.EnumErrorCode.DBR_SUCCESS){throw a.BarcodeReaderException(l.exception,l.description)}}return l};j.prototype.getAllParameterTemplateNames=function(){var k=[];for(var l=0;l<this._tplContentArr.length;++l){k.push(this._tplContentArr[l].ImageParameter.Name)}return k};j.prototype.getRuntimeSettings=function(){var k=this;if(k.bWasm){return a._wasmInstance.getRuntimeSettings()}if(!k._runtimeSettings){k._runtimeSettings=b.parse(a._defaultRuntimeSettingsStr)}return Promise.resolve(k._runtimeSettings)};var i='{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":["BF2_POSTALCODE","BF2_DOTCODE"],"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":3,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_STATISTICS_MARKS"},{"Mode":"LM_STATISTICS_POSTAL_CODE"}],"MaxAlgorithmThreadCount":4,"Name":"bestSpeed","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":2300,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"Mode":"TFM_SKIP"}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}',d='{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":["BF2_POSTALCODE","BF2_DOTCODE"],"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":5,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_STATISTICS"},{"Mode":"LM_STATISTICS_MARKS"},{"Mode":"LM_STATISTICS_POSTAL_CODE"}],"MaxAlgorithmThreadCount":4,"Name":"balance","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":2300,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"MinImageDimension":65536,"Mode":"TFM_GENERAL_CONTOUR","Sensitivity":0}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}',h='{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":["BF2_POSTALCODE","BF2_DOTCODE"],"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":9,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"},{"Mode":"GTM_INVERTED"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_SCAN_DIRECTLY","ScanDirection":0,"ScanStride":0},{"Mode":"LM_STATISTICS"},{"Mode":"LM_LINES"},{"Mode":"LM_STATISTICS_MARKS"},{"Mode":"LM_STATISTICS_POSTAL_CODE"}],"MaxAlgorithmThreadCount":4,"Name":"coverage","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":214748347,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"MinImageDimension":65536,"Mode":"TFM_GENERAL_CONTOUR","Sensitivity":0}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}',f='{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":null,"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":9,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_SCAN_DIRECTLY","ScanDirection":0,"ScanStride":0},{"Mode":"LM_STATISTICS"},{"Mode":"LM_LINES"}],"MaxAlgorithmThreadCount":4,"Name":"default","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":2300,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"MinImageDimension":65536,"Mode":"TFM_GENERAL_CONTOUR","Sensitivity":0}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}';j.prototype.updateRuntimeSettings=function(o){var l=this,n;if(typeof o=="string"||typeof o=="object"&&o instanceof String){if("speed"==o||"balance"==o||"coverage"==o||"default"==o){var k;if("speed"==o){k=i}else{if("balance"==o){k=d}else{if("coverage"==o){k=h}else{k=f}}}return l.initRuntimeSettingsWithString(k)}else{n=o}}else{if(typeof o=="object"){n=b.stringify(o)}else{throw TypeError("'setTemplateSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.")}}var m=b.parse(n);if(l.bWasm){return a._wasmInstance.updateRuntimeSettings(m).then(function(){return a._wasmInstance.getRuntimeSettings()})}l._runtimeSettings=m;l._initSettingsContent=null;return l._innerServiceCmd(l._runtimeSettings,null).then(function(p){var q=a._handleRetJsonString(p);l._runtimeSettings=q.settings;if(!l._runtimeSettings){l._runtimeSettings=b.parse(a._defaultRuntimeSettingsStr)}return q.settings})};j.prototype.resetRuntimeSettings=function(){var k=this;if(k.bWasm){return a._wasmInstance.resetRuntimeSettings().then(function(){return a._wasmInstance.getRuntimeSettings()})}k._runtimeSettings=b.parse(a._defaultRuntimeSettingsStr);k._initSettingsContent=null;return k._innerServiceCmd(k._runtimeSettings,null).then(function(l){var m=a._handleRetJsonString(l);k._runtimeSettings=m.settings;if(!k._runtimeSettings){k._runtimeSettings=b.parse(a._defaultRuntimeSettingsStr)}return m.settings})};j.prototype.outputSettingsToString=function(k){if(k){for(var l=0;l<this._tplContentArr.length;++l){if(k==this._tplContentArr[l].ImageParameter.Name){return b.stringify(this._tplContentArr[l])}}}else{return a._defaultTemplateStr}};j.prototype.initRuntimeSettingsWithString=function(l){var k=this;if(!b.isString(l)){throw TypeError("'initRuntimeSettingsWithString(settings)': Type of 'settings' should be 'String'.")}if(k.bWasm){return a._wasmInstance.initRuntimeSettingsWithString(l).then(function(){return a._wasmInstance.getRuntimeSettings()})}k._runtimeSettings=null;k._initSettingsContent=b.parse(l);return k._innerServiceCmd(null,k._initSettingsContent).then(function(m){var n=a._handleRetJsonString(m);k._runtimeSettings=n.settings;if(!k._runtimeSettings){k._runtimeSettings=b.parse(a._defaultRuntimeSettingsStr)}k._initSettingsContent=null;return n.settings})};return j})()})();Dynamsoft.AddonReady(function(d,b){var a;var e=Dynamsoft.BarcodeReaderAddon;e._dbr=false;e._initH5=function(h,g){return new Promise(function(j,i){e._urlRoot=Dynamsoft.dcp._getPreUrl(Dynamsoft.dcp.detect.curPortIndex)+"dcp/dbr_"+e.Version.replace(/\./g,"")+"/";d.ajax({method:"POST",url:e._urlRoot+"VersionInfo",data:'{"method":"VersionInfo"}',onSuccess:function(){j()},onError:function(){return i("Failed to connect to the Barcode Reader Add-on, the library may be missing in the Dynamsoft Service directory.")},dataType:"json",async:true,timeout:800})}).then(function(){e._dbr=new e.Class();return e._dbr._innerServiceCmd(null,null)}).then(function(i){try{var k=e._handleRetJsonString(i);e._dbr._runtimeSettings=k.settings;e._defaultRuntimeSettingsStr=d.stringify(k.settings);e._defaultTemplateStr=d.stringify(k.outputSettings);h(e._dbr)}catch(j){g("Init template & runtimeSettings failed: "+j.message||j)}},function(i){g(i)})};function f(){try{if(typeof WebAssembly==="object"&&typeof WebAssembly.instantiate==="function"){var g=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(g instanceof WebAssembly.Module){return new WebAssembly.Instance(g) instanceof WebAssembly.Instance}}}catch(h){}return false}e.dbrInitPromiseFun=function(m,l){var j=Dynamsoft.BarcodeReaderAddon,g=function(){Dynamsoft.BarcodeReader._productKeys=Dynamsoft.WebTwainEnv.ProductKey;Dynamsoft.BarcodeReader.createInstance().then(function(o){o._productKeys=Dynamsoft.WebTwainEnv.ProductKey;j._wasmInstance=o;return o.getRuntimeSettings()}).then(function(o){j._dbr._runtimeSettings=o;j._defaultRuntimeSettingsStr=d.stringify(o);m(j._dbr)})};if(j._dbr){if(j._dbr.bWasm&&!j._wasmInstance){g()}else{m(j._dbr)}return}var k="?t=2020525",h=Dynamsoft.WebTwainEnv.ResourcesPath,i=!Dynamsoft.navInfo.bWin||d.product.bHTML5Edition&&(!Dynamsoft.WebTwainEnv.UseLocalService||d.env.bMobile||Dynamsoft.WebTwainEnv.UseBarcodeAddonWasm);var n=function(){if(i){d.showLoadingMsg(-1,"",Dynamsoft.MSG.Init_CompilingWasm);Dynamsoft.BarcodeReader._bUseFullFeature=true;j._dbr=new j.Class();j._dbr.bWasm=true;g();return}if(d.product.bHTML5Edition){j._initH5(m,l)}else{var s=Dynamsoft.navInfoSync,o={method:"ReadBarcode",parameter:[Dynamsoft.WebTwainEnv.ProductKey,4002,"",""]};if(s.bIE&&parseInt(s.IEVersion)<=j._activeXMaxIEVersion){try{j._activeXInstance=new ActiveXObject("DBRModule.AtlDBR");var t=j._activeXInstance.Process(d.stringify(o),location.protocol+"//"+location.host);var r=d.parse(t);if(!r){return l(Error("The DBR init error."))}if("settings" in r){j._dbr=new j.Class();j._dbr._runtimeSettings=r.settings;j._defaultRuntimeSettingsStr=d.stringify(r.settings);if("outputSettings" in r){j._defaultTemplateStr=d.stringify(r.outputSettings)}m(j._dbr)}else{var p=r.description||"The DBR init error.";return l(Error(p))}}catch(q){return l(Error("The DBR .dll is missing or not accessible: "+(q.message||q)))}}}};if(i){if(!d.detect.dbrwasmScriptLoaded){if(!f()){l(Error(Dynamsoft.MSG.Err_BrowserNotSupportWasm));return}d.getScripts([[h,"/addon/dbrjs/dbr.js",k].join("")],true,function(o){d.detect.dbrwasmScriptLoaded=true;n()})}else{n()}}else{n()}};var c=function(h){var i=d.html5.Funs,g;if(Dynamsoft.dcp.b64bit){a="dbrx64_"+Dynamsoft.BarcodeReaderAddon.Version+".dll"}else{a="dbr_"+Dynamsoft.BarcodeReaderAddon.Version+".dll"}if(d.product.bHTML5Edition&&!h._isMobileMode()){h._innerSend("GetAddOnVersion",i.makeParams("barcodereader",a),true,false,false)}g={BarcodeReader:{decode:function(j){if(!d.License.checkProductKey(h,{Core:true})){return Promise.reject(h._errorString)}if(!d.isNumber(j)||j<0||j>=h.HowManyImagesInBuffer){d.Errors.IndexOutOfRange(h);return Promise.reject(h.ErrorString)}return Promise.resolve(j).then(function(l){var k;if(d.product.bHTML5Edition){k=h._ImgManager.convertClientIndexToServerId(l);if(k==-1){d.Errors.IndexOutOfRange(h);throw e.BarcodeReaderException(h._errorCode,h._errorString)}}else{k=l}return new Promise(function(n,m){e.dbrInitPromiseFun(function(q){if(q.bWasm){var o=q.getRuntimeSettings();o=o.then(function(t){if(t.expectedBarcodesCount==0){t.expectedBarcodesCount=512;return q.updateRuntimeSettings(t)}});if(h._isMobileMode()){o=o.then(function(){var t=h._ImgManager.convertServerIdToClientIndex(k);return h._ImgManager.getWebViewer().GetImageData(h._ImgManager.getUidByIndex(t))});o=o.then(function(t){return t.originalData})}else{o=o.then(function(){var t=h._ImgManager.convertServerIdToClientIndex(k);return h.GetImageURL(t,-1,-1)})}o=o.then(function(t){return fetch(t,{mode:"cors"}).then(function(u){return u.blob()}).then(function(u){return e._wasmInstance.decode(u)})});o.then(function(t){t.imageid=h.objImageIndexManager.convertServerIdToGuid(k);n(t)})}else{if(!d.product.bHTML5Edition){var r=k;var s=h.GetImagePartURL(r,-1,-1);return q._innerDecode(4001,s,"").then(function(t){t.imageid=h.IndexToImageID(r);n(t)})}if(!q.bWasm){var r=h._ImgManager.convertServerIdToClientIndex(k);var p=h.GetImagePartURL(r,-1,-1);return q._innerDecode(4000,p,"").then(function(t){t.imageid=h.IndexToImageID(r);n(t)})}}},m)})})},resetRuntimeSettings:function(){if(!d.License.checkProductKey(h,{Core:true})){return Promise.reject(h._errorString)}return new Promise(e.dbrInitPromiseFun).then(function(j){return j.resetRuntimeSettings()})},getRuntimeSettings:function(j){if(!d.License.checkProductKey(h,{Core:true})){return Promise.reject(h._errorString)}if(d.isString(j)&&("speed"==j||"balance"==j||"coverage"==j||"default"==j)){return this.updateRuntimeSettings(j)}return new Promise(e.dbrInitPromiseFun).then(function(k){return k.getRuntimeSettings()})},updateRuntimeSettings:function(j){if(!d.License.checkProductKey(h,{Core:true})){return Promise.reject(h._errorString)}return new Promise(e.dbrInitPromiseFun).then(function(k){return k.updateRuntimeSettings(j)})},initRuntimeSettingsWithString:function(j){if(!d.License.checkProductKey(h,{Core:true})){return Promise.reject(h._errorString)}return new Promise(e.dbrInitPromiseFun).then(function(k){return k.initRuntimeSettingsWithString(j)})}}};if(d.product.bHTML5Edition){h.__addon=h.__addon||{};d.mix(h.__addon,g)}else{h.Addon=h.Addon||{};d.mix(h.Addon,g)}};if(d.DynamicLoadAddonFuns){d.DynamicLoadAddonFuns.push(c)}});